<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Media Planning Brief Intake Form</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}
    .container{max-width:800px;margin:0 auto;background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.3);overflow:hidden}
    .header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:30px;text-align:center}
    .header h1{font-size:28px;margin-bottom:10px}
    .header p{opacity:.9;font-size:14px}
    .webhook-notice{background:#f0f4ff;border-left:4px solid #667eea;padding:15px;margin:20px 40px;border-radius:8px;display:flex;align-items:center;gap:10px}
    .webhook-notice .icon{font-size:20px}
    .webhook-notice code{background:#e0e7ff;padding:3px 8px;border-radius:4px;font-size:13px;word-break:break-all}
    .form-container{padding:40px}
    .form-section{margin-bottom:30px;padding-bottom:30px;border-bottom:1px solid #e0e0e0}
    .form-section:last-child{border-bottom:none}
    .section-title{color:#333;font-size:18px;font-weight:600;margin-bottom:20px;display:flex;align-items:center}
    .section-title::before{content:'';display:inline-block;width:4px;height:20px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);margin-right:10px;border-radius:2px}
    .form-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:20px}
    .form-group{display:flex;flex-direction:column}
    label{font-size:13px;font-weight:500;color:#555;margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px}
    label .required{color:#e53e3e;margin-left:2px}
    input[type="text"],input[type="email"],input[type="number"],input[type="date"],select,textarea{padding:12px 16px;border:2px solid #e0e0e0;border-radius:8px;font-size:15px;transition:all .3s;background:#fafafa}
    input:focus,select:focus,textarea:focus{outline:none;border-color:#667eea;background:#fff;box-shadow:0 0 0 3px rgba(102,126,234,.1)}
    input:invalid,select:invalid,textarea:invalid{border-color:#e0e0e0}
    input:valid:not(:placeholder-shown),select:valid,textarea:valid:not(:placeholder-shown){border-color:#48bb78}
    textarea{resize:vertical;min-height:100px;font-family:inherit}
    .tag-input-container{position:relative}
    .tag-input{display:flex;flex-wrap:wrap;gap:8px;padding:8px;border:2px solid #e0e0e0;border-radius:8px;background:#fafafa;min-height:45px;cursor:text;transition:all .3s}
    .tag-input.has-tags{border-color:#48bb78}
    .tag-input.required-empty{border-color:#fc8181}
    .tag{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:5px 10px;border-radius:15px;font-size:13px;display:flex;align-items:center;gap:5px}
    .tag .remove{cursor:pointer;background:rgba(255,255,255,.3);border-radius:50%;width:16px;height:16px;display:flex;align-items:center;justify-content:center;font-size:12px}
    .tag-input input{border:none;outline:none;background:transparent;flex:1;min-width:100px;padding:5px}
    .tag-count{position:absolute;right:10px;top:-8px;background:#667eea;color:#fff;padding:2px 8px;border-radius:10px;font-size:11px;font-weight:600}
    .button-group{display:flex;gap:15px;margin-top:30px;flex-wrap:wrap}
    button{padding:14px 28px;border:none;border-radius:8px;font-size:15px;font-weight:600;cursor:pointer;transition:all .3s;text-transform:uppercase;letter-spacing:.5px}
    .btn-primary{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;flex:1}
    .btn-primary:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 10px 20px rgba(102,126,234,.3)}
    .btn-primary:disabled{opacity:.5;cursor:not-allowed}
    .btn-secondary{background:#f0f0f0;color:#333}
    .btn-secondary:hover{background:#e0e0e0}
    .btn-sample{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:#fff}
    .btn-sample:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(245,87,108,.3)}
    .status-message{padding:15px;border-radius:8px;margin-top:20px;display:none;animation:slideIn .3s ease}
    @keyframes slideIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
    .status-success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
    .status-error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}
    .json-preview{background:#2d3748;color:#48bb78;padding:20px;border-radius:8px;margin-top:20px;font-family:'Courier New',monospace;font-size:13px;max-height:400px;overflow-y:auto;display:none;white-space:pre-wrap}
    .loading{display:none;text-align:center;padding:20px}
    .spinner{border:3px solid #f3f3f3;border-top:3px solid #667eea;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:0 auto}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    .validation-message{color:#e53e3e;font-size:12px;margin-top:5px;display:none}
    .validation-message.show{display:block}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>🎯 Media Planning Brief Intake</h1>
      <p>Automated Media Planning Workflow Demo</p>
    </div>

    <div class="webhook-notice">
      <span class="icon">🔗</span>
      <div>
        Webhook target:&nbsp;<code id="webhookDisplay"></code>
      </div>
    </div>

    <div class="form-container">
      <form id="mediaBriefForm">
        <div class="form-section">
          <h3 class="section-title">Client Information</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="client">Client Name <span class="required">*</span></label>
              <input type="text" id="client" name="client" required placeholder="Enter client name">
            </div>
            <div class="form-group">
              <label for="campaign_name">Campaign Name <span class="required">*</span></label>
              <input type="text" id="campaign_name" name="campaign_name" required placeholder="Enter campaign name">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="owner_email">Owner Email <span class="required">*</span></label>
              <input type="email" id="owner_email" name="owner_email" required placeholder="email@company.com">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3 class="section-title">Campaign Strategy</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="objective">Objective <span class="required">*</span></label>
              <select id="objective" name="objective" required>
                <option value="">Select objective...</option>
                <option value="Awareness">Awareness</option>
                <option value="Consideration">Consideration</option>
                <option value="Conversion">Conversion</option>
                <option value="Lead Generation">Lead Generation</option>
              </select>
            </div>
            <div class="form-group">
              <label for="primary_kpi">Primary KPI <span class="required">*</span></label>
              <select id="primary_kpi" name="primary_kpi" required>
                <option value="">Select KPI...</option>
                <option value="Reach">Reach</option>
                <option value="Impressions">Impressions</option>
                <option value="CTR">CTR</option>
                <option value="Conversions">Conversions</option>
                <option value="ROAS">ROAS</option>
                <option value="CPM">CPM</option>
                <option value="CPC">CPC</option>
                <option value="CPA">CPA</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="audience">Target Audience <span class="required">*</span></label>
            <textarea id="audience" name="audience" required minlength="20"
              placeholder="Describe your target audience demographics, interests, and behaviors..."></textarea>
          </div>
        </div>

        <div class="form-section">
          <h3 class="section-title">Markets & Geography</h3>
          <div class="form-group">
            <label>Target Markets <span class="required">*</span> (Press Enter to add, minimum 1 required)</label>
            <div class="tag-input-container">
              <div class="tag-input required-empty" id="marketsContainer" onclick="focusTagInput('markets')">
                <div id="marketsTags"></div>
                    <input type="text" id="marketsInput" placeholder="e.g., UAE, Saudi Arabia, Egypt"
                        onkeydown="handleTagInput(event, 'markets')">

              </div>
              <span class="tag-count" id="marketsCount" style="display:none;">0</span>
            </div>
            <span class="validation-message" id="marketsValidation">Please add at least one target market</span>
          </div>
        </div>

        <div class="form-section">
          <h3 class="section-title">Budget & Timeline</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="budget_amount">Budget Amount <span class="required">*</span></label>
              <input type="number" id="budget_amount" name="budget_amount" min="1000" required placeholder="Minimum 1000">
            </div>
            <div class="form-group">
              <label for="budget_currency">Currency <span class="required">*</span></label>
              <select id="budget_currency" name="budget_currency" required>
                <option value="AED">AED</option><option value="USD">USD</option>
                <option value="EUR">EUR</option><option value="GBP">GBP</option><option value="SAR">SAR</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="start_date">Start Date <span class="required">*</span></label>
              <input type="date" id="start_date" name="start_date" required>
            </div>
            <div class="form-group">
              <label for="end_date">End Date <span class="required">*</span></label>
              <input type="date" id="end_date" name="end_date" required>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3 class="section-title">Channel Preferences</h3>
          <div class="form-group">
            <label>Include Channels <span class="required">*</span> (Press Enter to add, minimum 1 required)</label>
            <div class="tag-input-container">
              <div class="tag-input required-empty" id="includeContainer" onclick="focusTagInput('include')">
                <div id="includeTags"></div>
                <input type="text" id="includeInput" placeholder="e.g., Meta, YouTube, TikTok"
                  onkeydown="handleTagInput(event, 'include')">
              </div>
              <span class="tag-count" id="includeCount" style="display:none;">0</span>
            </div>
            <span class="validation-message" id="includeValidation">Please add at least one channel to include</span>
          </div>
          <div class="form-group">
            <label>Exclude Channels (Optional, Press Enter to add)</label>
            <div class="tag-input-container">
              <div class="tag-input" id="excludeContainer" onclick="focusTagInput('exclude')">
                <div id="excludeTags"></div>
                <input type="text" id="excludeInput" placeholder="e.g., Twitter, Snapchat"
                  onkeydown="handleTagInput(event, 'exclude')">
              </div>
              <span class="tag-count" id="excludeCount" style="display:none;">0</span>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3 class="section-title">Requirements</h3>
          <div class="form-group">
            <label>Mandatory Requirements <span class="required">*</span> (Press Enter to add, minimum 1 required)</label>
            <div class="tag-input-container">
              <div class="tag-input required-empty" id="mandatoriesContainer" onclick="focusTagInput('mandatories')">
                <div id="mandatoriesTags"></div>
                <input type="text" id="mandatoriesInput" placeholder="e.g., Minimum 40% video content"
                  onkeydown="handleTagInput(event, 'mandatories')">
              </div>
              <span class="tag-count" id="mandatoriesCount" style="display:none;">0</span>
            </div>
            <span class="validation-message" id="mandatoriesValidation">Please add at least one mandatory requirement</span>
          </div>
        </div>

        <div class="button-group">
          <button type="button" class="btn-sample" onclick="loadSampleData()">📝 Load Sample Data</button>
          <button type="button" class="btn-secondary" onclick="previewJSON()">👁️ Preview JSON</button>
          <button type="submit" class="btn-primary" id="submitBtn">🚀 Submit Brief</button>
        </div>
      </form>

      <div id="statusMessage" class="status-message"></div>
      <pre id="jsonPreview" class="json-preview"></pre>
      <div id="loading" class="loading">
        <div class="spinner"></div>
        <p style="margin-top:10px;">Processing your brief...</p>
      </div>
    </div>
  </div>

  <script>
    // === CONFIG: CHANGE THIS TO YOUR n8n WEBHOOK ===
    // Use /webhook-test/... while testing (with "Execute workflow" pressed)
    // Use /webhook/... after you set the workflow Active
    const WEBHOOK_URL = 'https://statsmo.app.n8n.cloud/webhook/media-brief-intake';

    // Show webhook on page (without crashing if element missing)
    const wd = document.getElementById('webhookDisplay');
    if (wd) wd.textContent = WEBHOOK_URL;

    // Tag state
    const tags = { markets: [], include: [], exclude: [], mandatories: [] };

    function handleTagInput(event, type) {
      if (event.key === 'Enter') {
        event.preventDefault();
        const input = document.getElementById(type + 'Input');
        const value = input.value.trim();
        if (value) {
          addTag(type, value);
          input.value = '';
          validateTagField(type);
        }
      }
    }
    function addTag(type, value) {
      if (!tags[type].includes(value)) {
        tags[type].push(value);
        renderTags(type);
        updateTagCount(type);
        validateTagField(type);
      }
    }
    function removeTag(type, index) {
      tags[type].splice(index, 1);
      renderTags(type);
      updateTagCount(type);
      validateTagField(type);
    }
    function renderTags(type) {
      const container = document.getElementById(type + 'Tags');
      container.innerHTML = tags[type].map((tag, i) => `
        <span class="tag">${tag}<span class="remove" onclick="removeTag('${type}', ${i})">×</span></span>
      `).join('');
    }
    function updateTagCount(type) {
      const el = document.getElementById(type + 'Count');
      if (!el) return;
      if (tags[type].length > 0) { el.textContent = tags[type].length; el.style.display = 'block'; }
      else { el.style.display = 'none'; }
    }
    function validateTagField(type) {
      const container = document.getElementById(type + 'Container');
      const validation = document.getElementById(type + 'Validation');
      const required = ['markets', 'include', 'mandatories'];
      if (!required.includes(type)) return;
      if (tags[type].length === 0) {
        container.classList.add('required-empty'); container.classList.remove('has-tags');
        if (validation) validation.classList.add('show');
      } else {
        container.classList.remove('required-empty'); container.classList.add('has-tags');
        if (validation) validation.classList.remove('show');
      }
    }
    function focusTagInput(type) { document.getElementById(type + 'Input').focus(); }

    function loadSampleData() {
      tags.markets = []; tags.include = []; tags.exclude = []; tags.mandatories = [];
      document.getElementById('client').value = 'TechStart MENA';
      document.getElementById('campaign_name').value = 'Q1 2025 Brand Awareness Push';
      document.getElementById('owner_email').value = 'marketing@techstart.ae';
      document.getElementById('objective').value = 'Awareness';
      document.getElementById('primary_kpi').value = 'Reach';
      document.getElementById('audience').value = 'Tech-savvy millennials and Gen Z, 22-38, interested in fintech and digital banking, early adopters of financial technology, mobile-first users with high digital engagement rates';
      document.getElementById('budget_amount').value = '150000';
      document.getElementById('budget_currency').value = 'AED';
      const today = new Date();
      const startDate = new Date(today.getFullYear(), today.getMonth() + 1, 1);
      const endDate = new Date(today.getFullYear(), today.getMonth() + 3, 0);
      document.getElementById('start_date').value = startDate.toISOString().split('T')[0];
      document.getElementById('end_date').value = endDate.toISOString().split('T')[0];
      tags.markets = ['UAE','Saudi Arabia','Egypt','Kuwait','Bahrain']; renderTags('markets'); updateTagCount('markets'); validateTagField('markets');
      tags.include = ['Meta','YouTube','TikTok','LinkedIn','Programmatic Display']; renderTags('include'); updateTagCount('include'); validateTagField('include');
      tags.exclude = ['Twitter','Snapchat','Reddit','Pinterest']; renderTags('exclude'); updateTagCount('exclude');
      tags.mandatories = ['Minimum 40% on video formats','Include Arabic creative versions','Weekend-heavy delivery (Thu-Sat)','Brand safety controls required','Monthly performance reviews','A/B testing for all creatives'];
      renderTags('mandatories'); updateTagCount('mandatories'); validateTagField('mandatories');
      showStatus('✨ Sample data loaded successfully! All required fields populated.','success');
    }

    function buildJSON() {
      return {
        client: document.getElementById('client').value,
        campaign_name: document.getElementById('campaign_name').value,
        objective: document.getElementById('objective').value,
        primary_kpi: document.getElementById('primary_kpi').value,
        markets_geo: tags.markets,
        audience: document.getElementById('audience').value,
        budget: {
          amount: parseInt(document.getElementById('budget_amount').value, 10),
          currency: document.getElementById('budget_currency').value
        },
        dates: {
          start: document.getElementById('start_date').value,
          end: document.getElementById('end_date').value
        },
        channels_in_out: { include: tags.include, exclude: tags.exclude },
        mandatories: tags.mandatories,
        owner_email: document.getElementById('owner_email').value
      };
    }

    function previewJSON() {
      const preview = document.getElementById('jsonPreview');
      preview.textContent = JSON.stringify(buildJSON(), null, 2);
      preview.style.display = 'block';
    }

    function showStatus(message, type) {
      const el = document.getElementById('statusMessage');
      el.textContent = message;
      el.className = 'status-message status-' + (type === 'success' ? 'success' : 'error');
      el.style.display = 'block';
      setTimeout(()=>{ el.style.display='none'; }, 5000);
    }

    function validateAllTagFields() {
      const req = [{name:'markets',min:1},{name:'include',min:1},{name:'mandatories',min:1}];
      let ok = true;
      for (const f of req) {
        if (tags[f.name].length < f.min) { validateTagField(f.name); ok = false; }
      }
      return ok;
    }

    // Submit handler — posts as application/x-www-form-urlencoded to avoid CORS preflight
    document.getElementById('mediaBriefForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!validateAllTagFields()) { showStatus('⚠️ Please fill in all required fields','error'); return; }

      const loading = document.getElementById('loading'); loading.style.display = 'block';
      try {
        const jsonData = buildJSON();
        const body = 'payload=' + encodeURIComponent(JSON.stringify(jsonData));
        const res = await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
          body
        });

        if (res.ok) {
          showStatus('✅ Brief submitted to n8n. Check execution / email for results.','success');
          const preview = document.getElementById('jsonPreview');
          preview.textContent = 'Sent payload:\n' + JSON.stringify(jsonData, null, 2);
          preview.style.display = 'block';
        } else {
          showStatus('❌ Webhook responded with HTTP ' + res.status,'error');
        }
      } catch (err) {
        console.error(err);
        showStatus('❌ Could not reach webhook. Check URL / workflow status.','error');
      } finally {
        loading.style.display = 'none';
      }
    });

    // Initialize
    window.onload = () => {
      // mark required tag fields as empty on load (for red outline)
      validateTagField('markets');
      validateTagField('include');
      validateTagField('mandatories');
    };
  </script>
</body>
</html>
